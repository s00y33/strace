/*
 * Copyright (c) 2021 The strace developers.
 * All rights reserved.
 *
 * SPDX-License-Identifier: GPL-2.0-or-later
 */

#include "tests.h"
#include "scno.h"

/*
 * This test is designed to be executed with the following strace options:
 * --secontext[=full]
 *
 * The expected output is suitable enough for pattern matching.
 */

#if defined __NR_execve && defined HAVE_SELINUX_RUNTIME

# include <stdio.h>

# include "selinux.c"

int
main(int argc, char *argv[], char *envp[])
{
	int i = 0;
	while (envp[i] != NULL) i++;
	printf("%sexecve\\(\"%s\"%s, \\[\"%s\"\\], 0x[0-9a-f]* /\\* %d vars \\*/\\) = 0\n",
	       SELINUX_MYCONTEXT_QUOTED(),
	       argv[0], SELINUX_FILECONTEXT_QUOTED(argv[0]),
	       argv[0], i);
	return 0;
}

#else

SKIP_MAIN_UNDEFINED("__NR_execve && HAVE_SELINUX_RUNTIME")

#endif
